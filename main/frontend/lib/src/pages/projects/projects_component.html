<h4>Projects</h4>
<p class="text-muted">Manage and access projects of the organization</p>
<hr>

<div *ngIf="user != null && organization != null">

  <div class="btn-group btn-group-sm">
    <button (click)="newProjectModal.open(user, organization)" *ngIf="canCreate" class="btn btn-primary" type="button">
      Create
    </button>
  </div>

  <hr>

  <div *ngIf="organization.projects.length > 0" class="list-group">
    <div *ngFor="let project of organization.projects" class="list-group-item pyro-list-entry">
      <div class="list-group-item-heading d-flex flex-row">
        <div (click)="openCurrentProject(project)" class="w-100 d-flex flex-row align-items-center" style="cursor: pointer">
          <h5 class="w-100 m-0 mr-2">{{project.name}}</h5>
          <workspace-image-badge class="flex-shrink-0 mr-3" [image]="project.template" *ngIf="project.template != null"></workspace-image-badge>
          <span class="language-editor-badge flex-shrink-0 mr-3" *ngIf="project.template == null">Language editor</span>
        </div>
        <div class="flex-shrink-0">
          <bs-dropdown>
            <button class="btn btn-sm ml-1 dropdown-toggle no-caret" type="button">
              <i class="fas fa-fw fa-ellipsis-h"></i>
            </button>
            <bs-dropdown-menu class="dropdown-menu-right">
              <li (click)="showEditProject(project)" *ngIf="canEdit">
                <div class="dropdown-item"><i class="fas fa-fw fa-edit"></i> Edit</div>
              </li>
              <li (click)="removeProject(project)" *ngIf="canDelete">
                <div class="dropdown-item"><i class="fas fa-fw fa-trash"></i> Delete</div>
              </li>
              <ng-container *ngIf="project.template == null">
                <div class="dropdown-divider"></div>
                <li>
                  <a class="dropdown-item" [routerLink]="getProjectBuildJobsUrl(project)"><i class="fas fa-fw fa-history"></i> Build Jobs</a>
                </li>
              </ng-container>
            </bs-dropdown-menu>
          </bs-dropdown>
        </div>
      </div>

      <div class="list-group-item-text">
        <p *ngIf="project.description.trim() != ''">
          <em>{{project.description}}</em>
        </p>
        <div class="text-muted">
          Owner:
          <strong *ngIf="project.owner.id == user.id">You</strong>
          <em *ngIf="project.owner.id != user.id">{{project.owner.username}}</em>
        </div>
        <div class="text-muted" *ngIf="project.image != null">
          Image: <em>@{{project.image.imageName}}</em>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="organization.projects.length === 0" class="alert alert-info">
    There are no projects in this organization yet.
  </div>

</div>

<edit-project
    (close)="showEditProjectModal=false"
    (editedProject)="handleProjectEdited($event)"
    *ngIf="showEditProjectModal"
    [organization]="organization"
    [project]="editProject"
    [user]="user"
>
</edit-project>

<delete-project
    (close)="showDeleteProjectModal=false"
    (delete)="handleProjectDeleted()"
    *ngIf="showDeleteProjectModal"
    [project]="deleteProject"
    [user]="user"
>
</delete-project>

<new-project
    #newProjectModal
    (dismiss)="newProjectModal.close()"
    (newProject)="handleNewProject($event)"
>
</new-project>
