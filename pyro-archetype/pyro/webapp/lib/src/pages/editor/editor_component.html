<div *ngIf="user!=null">
	<properties
		*ngIf="isGraphModel"
	    [user]="user"
	    [isModal]="true"
	    [currentGraphModel]="currentFile"
	    [currentGraphElement]="selectedElementModal"
	    (hasChanged)="changedProperties($event)"
	    (hasClosed)="selectionChangedModal(null)"
	>
	</properties>
	<div class="row" *ngIf="grid != null&&mainLayout=='micro'" style="margin-right:0">
		<div [style.width.px]="selected==null?'39':'265'" style="padding-right: 0;">
			<div class="row">
				<button id="menu-button" (click)="toggleNav()" class="btn btn-primary" style="width: 36px;height: 32px;margin-left: 34px;margin-top: 0px;"><i class="fas fa-list-ul _ngcontent-hvg-13"></i></button>
		        <div id="scroll-menu" [style.top.px]="showNav?100:31" >
		          <ul class="nav nav-tabs left-tabs sideways-tabs" style="margin-top:50px;">
		        	<ng-container *ngFor="let widgetArea of grid.items; trackBy: trackByWidgetAreaId">
		        		<ng-container *ngFor="let widget of widgetArea.widgets; trackBy: trackByWidgetId">
				            <li *ngIf="widget.key=='palette'" class="nav-item">
				              <a class="nav-link" [class.active]="selected=='palette'" title="Show Palette" href (click)="selectView($event,'palette')">Palette</a>
				            </li>
				            <li *ngIf="widget.key=='checks'" class="nav-item">
				              <a class="nav-link" [class.active]="selected=='check'" title="Show Checks" href (click)="selectView($event,'check')">Check</a>
				            </li>
				            <li *ngIf="widget.key=='command_history'" class="nav-item">
				              <a class="nav-link" [class.active]="selected=='comman-history'" title="Show Command History" href (click)="selectView($event,'comman-history')">History</a>
				            </li>
						    <li *ngIf="widget.key=='plugin_ecore'" class="nav-item">
						      <a class="nav-link" [class.active]="selected=='Ecore'" title="Show Ecore" href (click)="selectView($event,'Ecore')">Ecore</a>
						    </li>
			            </ng-container>
		            </ng-container>
		          </ul>
		        </div>
	
		        <div class="pyro-micor-menu" style="height: 100%;padding-left:0;width:210px;border: #57747b 2px solid;" *ngIf="selected!=null">
		        	<h5 style="margin-top: 7px;margin-bottom:5px;text-align: center;">{{selected}}</h5>
			          <palette class="d-flex flex-column h-100"
							*ngIf="selected=='palette'&&isGraphModel"
					        [currentGraphModel]="currentFile"
					        [permissionVectors]="permissionVectors"
					        (dragged)="currentDragging($event)"
				        ></palette>
				      <check
	                	*ngIf="selected=='check'&&isGraphModel"
	            	    class="d-flex flex-column h-100"
	                    [currentGraphModel]="currentFile"
	                  ></check>
	                   <command-history
		            	    class="d-flex flex-column h-100"
		            	    (reverted)="graphService.canvasComponent.undo()"
		                	*ngIf="isGraphModel&&selected=='comman-history'"
		                ></command-history>
						<tree-view
						    *ngIf="selected=='Ecore'&&isGraphModel"
							[user]="user"
							[currentGraphModel]="currentFile"
						    [name]="'Ecore'"
							[fetchUrl]="'ecoreview/read/private'"
							[clickUrl]="''"
							[dbClickUrl]="''"
							>
						</tree-view>
		        </div>
			</div>
		</div>
		<div [class.micro-column-right-xl]="selected==null" [class.micro-column-right-sm]="selected!=null" style="height: calc(100vh + 28px);overflow: hidden;padding-left: 0;">
			<pyro-canvas
	    	    class="d-flex flex-column h-100" 
	    	    style="overflow: hidden"
	        	#canvas
	        	[user]="user"
	            [currentFile]="currentFile"
	            [currentLocalSettings]="currentLocalSettings"
	            [permissionVectors]="permissionVectors"
	            (selectionChanged)="selectionChanged($event)"
	            (selectionChangedModal)="selectionChangedModal($event)"
	            (hasChanged)="changedGraph($event)"
	                (jumpTo)="jumpToPrime($event)"
	          ></pyro-canvas>
		</div>
	</div>
	
    <div class="grid-stack" *ngIf="mainLayout=='classic'&&grid != null">
    
 		<ng-container *ngFor="let widgetArea of grid.items; trackBy: trackByWidgetAreaId">
	    	<div 
				class="grid-stack-item" 
				*ngIf="gridItemMap[widgetArea.id] != null"
				[class.fullscreen]="isFullscreen(widgetArea.id)"
				[class.hidden]="!showWidget(widgetArea.id)"
				[attr.data-gs-id]="widgetArea.id"
			>
			  <div class="grid-stack-item-content">
				<div class="grid-stack-item-header d-flex align-items-center justify-content-end" style="min-height: 25px"> 
				  <i class="fas fa-trash" 
				  	 (click)="removeWidgetArea($event, widgetArea)"
				  	 *ngIf="!isFullscreen(widgetArea.id)"
				  ></i>
 				  <i class="ml-3 fas" 
 				  	 [class.fa-compress]="isFullscreen(widgetArea.id)"
 				  	 [class.fa-expand]="!isFullscreen(widgetArea.id)"
 				  	 (click)="toggleFullscreen(widgetArea.id)"
 				  ></i>
				</div>
			    <div class="grid-stack-item-body" *ngIf="widgetArea.widgets.length > 0">
			    
				<editor-tabs-dropzone [area]="widgetArea" (drop)="moveWidget($event)">
				    <bs-tabs #tabs>
				  		<ng-container *ngFor="let widget of widgetArea.widgets; trackBy: trackByWidgetId">
				  		  <template bsTab [select]="widget.key">
				  		  	<editor-tabs-draggable 
				  		  		[widget]="widget" 
				  		  		(close)="removeWidget(null, widgetArea, $event)"
				  		  		(detach)="createWidgetArea($event)"
				  		  	>
						      {{widget.tab}} <small (click)="removeWidget($event, widgetArea, widget)"><i class="remove-widget fas fa-times ml-1"></i></small>
						    </editor-tabs-draggable>
						  </template>
					    </ng-container>
				    </bs-tabs>
				</editor-tabs-dropzone>
					
				  <bs-tab-content [for]="tabs">
				    <ng-container *ngFor="let widget of widgetArea.visibleWidgets; trackBy: trackByWidgetId">
				      <template bs-tab-panel [name]="widget.key">
				       
				       <div [ngSwitch]="widget.key">
						<ng-container *ngSwitchCase="'canvas'">
						  <pyro-canvas
						    class="d-flex flex-column h-100" 
						    style="overflow: hidden"
							#canvas
							[user]="user"
						    [currentFile]="currentFile"
						    [currentLocalSettings]="currentLocalSettings"
						    [permissionVectors]="permissionVectors"
						    (selectionChanged)="selectionChanged($event)"
						    (selectionChangedModal)="selectionChangedModal($event)"
						    (hasChanged)="changedGraph($event)"
						    (jumpTo)="jumpToPrime($event)"
						  ></pyro-canvas>
						</ng-container>
			            
			            <ng-container *ngSwitchCase="'properties'">
				            <properties
			            	    class="d-flex flex-column h-100"
				                *ngIf="currentFile != null && selectedElement != null && isGraphModel"
				                [user]="user"
				                [currentGraphModel]="currentFile"
				                [currentGraphElement]="selectedElement"
				                (hasChanged)="changedProperties($event)"
				            >
				            </properties>
			            </ng-container>
			            
			            <ng-container *ngSwitchCase="'palette'">
				            <palette class="d-flex flex-column h-100"
								*ngIf="isGraphModel"
						        [currentGraphModel]="currentFile"
						        [permissionVectors]="permissionVectors"
						        (dragged)="currentDragging($event)"
					        ></palette>
			            </ng-container>
			            
			            <ng-container *ngSwitchCase="'checks'">
				            <check
			            	    class="d-flex flex-column h-100"
			                	*ngIf="isGraphModel"
			                    [currentGraphModel]="currentFile"
			                ></check>
			            </ng-container>
			            
			            <ng-container *ngSwitchCase="'command_history'">
				              <command-history
			            	    class="d-flex flex-column h-100"
			            	    (reverted)="graphService.canvasComponent.undo()"
			                	*ngIf="isGraphModel"
			                ></command-history>
			            </ng-container>
			            
						<ng-container *ngSwitchCase="'plugin_ecore'">
						    <tree-view
						        *ngIf="isGraphModel"
								[user]="user"
								[currentGraphModel]="currentFile"
						        [name]="'Ecore'"
								[fetchUrl]="'ecoreview/read/private'"
								[clickUrl]="''"
								[dbClickUrl]="''"
							>
							</tree-view>
						</ng-container>
			            		
						<div *ngSwitchDefault>
						  No widget available
						</div>
					  </div>
				       
				      </template>
				    </ng-container>
				  </bs-tab-content>
			   
			    </div>
			  </div>
			</div>
		</ng-container>  
    		    
    </div>
</div>
